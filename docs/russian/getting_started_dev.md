# Getting started for developers

```text
Disclaimer

Инструкция написана для linux (проверялась на debian). Адаптация этой инструкции для windows или macOS не планируется, но будет с благодарностью принята, если найдутся желающие адаптировать.

То же самое касается перевода инструкции на другие языки.
```

В данный момент бот состоит из двух репозиториев:

- [сам бот](https://github.com/dziaineka/parkun-bot)
- [отправитель обращений](https://github.com/dziaineka/appeal_preparer)

Подробнее про архитектуру паркуна можно почитать [здесь](./parkun_arch.md).

Посему и разворот бота состоит из двух больших шагов:

- разворот бота
- разворот отправителя обращений

Для всего этого вам точно понадобится:

- gcc
- git
- docker
- docker-compose
- python (конкретная версия указана в файле [.tool-versions](../../.tool-versions))

## Разворот бота

Для начала нужно клонировать бота себе на компьютер:

```sh
git clone https://github.com/dziaineka/parkun-bot.git
```

В репозитории две ветки: master и develop. Для разработки какой-то фичи или исправления ошибки вам нужно создать собственную ветку на основе ветки develop:

```sh
cd parkun-bot
git checkout develop
git checkout -b my-new-feature
```

Далее нужно задать токен своего тестового бота в [конфиге](../../config.py), который лежит в корне проекта (как зарегистрировать бота можно посмотреть в интернете. Например, [здесь](https://way23.ru/%D1%80%D0%B5%D0%B3%D0%B8%D1%81%D1%82%D1%80%D0%B0%D1%86%D0%B8%D1%8F-%D0%B1%D0%BE%D1%82%D0%B0-%D0%B2-telegram/)).

Заменяем строку `PUT_TOKEN_HERE` на свой токен.

Разворачиваем питонье окружение магической [командой](../../Makefile). Она создаст окружение и установит зависимости:

```sh
make py_env
```

Активируем питонье окружение:

```sh
source .venv/bin/activate
```

Второй магической командой поднимаем окружение бота в docker-контейнерах:

```sh
make start_dev_env
```

Этой командой у вас поднимется очередь (RabbitMQ), хранилище (Redis) и сервер заглушек для некоторых вспомогательных сервисов.

Запускаем, наконец, бота:

```sh
python main.py
```

После этого можно проверять в телеграме, что ваш бот жив и легитимен. Дорабатывать бота частично можно и без отправителя. Зависит от того, что нужно сделать.

## Разворот отправителя обращений

Для отправителя дополнительно потребуется установить:

- Chrome/Chromium
- chromedriver

Клонируем репозиторий отправителя:

```sh
git clone https://github.com/dziaineka/appeal_preparer.git
```

В репозитории две ветки: master и develop. Для разработки какой-то фичи или исправления ошибки вам нужно создать собственную ветку на основе ветки develop:

```sh
cd appeal_preparer
git checkout develop
git checkout -b my-new-feature
```

Разворачиваем питонье окружение магической командой. Она создаст окружение и установит зависимости:

```sh
make py_env
```

Активируем питонье окружение:

```sh
source .venv/bin/activate
```

Далее нужно задать свой тестовый адрес email и пароль в [конфиге](https://github.com/dziaineka/appeal_preparer/blob/master/config.py), который лежит в корне проекта. Пока что почта должна хоститься на [outlook.com](outlook.com).

Отправителей запустится столько, сколько указано адресов в `EMAILS`. Пароль на них всех общий в поле `EMAIL_PWD`. Для разработки хватает одного, как правило.

Запускаем отправителей:

```sh
python main.py
```

Запустятся отправители.
